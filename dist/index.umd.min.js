!(function (e, t) {
  'object' == typeof exports && 'undefined' != typeof module
    ? t(exports, require('react'))
    : 'function' == typeof define && define.amd
    ? define(['exports', 'react'], t)
    : t(
        ((e =
          'undefined' != typeof globalThis
            ? globalThis
            : e || self).reactSliderVertify = {}),
        e.React,
      );
})(this, function (e, t) {
  'use strict';
  function r(e) {
    return e && 'object' == typeof e && 'default' in e ? e : { default: e };
  }
  var n = r(t);
  function o(e) {
    return e &&
      e.__esModule &&
      Object.prototype.hasOwnProperty.call(e, 'default')
      ? e.default
      : e;
  }
  function u(e, t, r) {
    return (
      e(
        (r = {
          path: t,
          exports: {},
          require: function (e, t) {
            return (function () {
              throw Error(
                'Dynamic requires are not currently supported by @rollup/plugin-commonjs',
              );
            })();
          },
        }),
        r.exports,
      ),
      r.exports
    );
  }
  var i = u(function (e) {
      (e.exports = function (e) {
        if (Array.isArray(e)) return e;
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    a = u(function (e) {
      (e.exports = function (e, t) {
        var r =
          null == e
            ? null
            : ('undefined' != typeof Symbol && e[Symbol.iterator]) ||
              e['@@iterator'];
        if (null != r) {
          var n,
            o,
            u = [],
            i = !0,
            a = !1;
          try {
            for (
              r = r.call(e);
              !(i = (n = r.next()).done) &&
              (u.push(n.value), !t || u.length !== t);
              i = !0
            );
          } catch (e) {
            (a = !0), (o = e);
          } finally {
            try {
              i || null == r.return || r.return();
            } finally {
              if (a) throw o;
            }
          }
          return u;
        }
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    c = u(function (e) {
      (e.exports = function (e, t) {
        (null == t || t > e.length) && (t = e.length);
        for (var r = 0, n = Array(t); t > r; r++) n[r] = e[r];
        return n;
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    l = u(function (e) {
      (e.exports = function (e, t) {
        if (e) {
          if ('string' == typeof e) return c(e, t);
          var r = Object.prototype.toString.call(e).slice(8, -1);
          return (
            'Object' === r && e.constructor && (r = e.constructor.name),
            'Map' === r || 'Set' === r
              ? Array.from(e)
              : 'Arguments' === r ||
                /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
              ? c(e, t)
              : void 0
          );
        }
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    s = u(function (e) {
      (e.exports = function () {
        throw new TypeError(
          'Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.',
        );
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    f = o(
      u(function (e) {
        (e.exports = function (e, t) {
          return i(e) || a(e, t) || l(e, t) || s();
        }),
          (e.exports.default = e.exports),
          (e.exports.__esModule = !0);
      }),
    );
  function d(e, t) {
    return Math.round(Math.random() * (t - e) + e);
  }
  function p(e, t) {
    return e + t;
  }
  function h(e) {
    return e * e;
  }
  (e.Vertify = t.memo(function (e) {
    var r = e.width,
      o = void 0 === r ? 320 : r,
      u = e.height,
      i = void 0 === u ? 160 : u,
      a = e.l,
      c = void 0 === a ? 42 : a,
      l = e.r,
      s = void 0 === l ? 9 : l,
      m = e.imgUrl,
      v = e.text,
      y = e.refreshIcon,
      x = void 0 === y ? 'http://cdn.dooring.cn/dr/icon12.png' : y,
      g = e.visible,
      b = void 0 === g || g,
      w = e.onDraw,
      M = e.onCustomVertify,
      C = e.onSuccess,
      _ = e.onFail,
      E = e.onRefresh,
      S = t.useState(!1),
      T = f(S, 2),
      R = T[0],
      I = T[1],
      N = t.useState(0),
      A = f(N, 2),
      j = A[0],
      D = A[1],
      O = t.useState('sliderContainer'),
      X = f(O, 2),
      k = X[0],
      q = X[1],
      P = t.useState(v),
      U = f(P, 2),
      Y = U[0],
      V = U[1],
      F = t.useRef(null),
      L = t.useRef(null),
      W = t.useRef(null),
      G = t.useRef(!1),
      H = t.useRef([]),
      $ = t.useRef(0),
      z = t.useRef(0),
      B = t.useRef(0),
      J = t.useRef(0),
      K = Math.PI,
      Q = c + 2 * s + 3,
      Z = function (e, t, r, n) {
        e.beginPath(),
          e.moveTo(t, r),
          e.arc(t + c / 2, r - s + 2, s, 0.72 * K, 2.26 * K),
          e.lineTo(t + c, r),
          e.arc(t + c + s - 2, r + c / 2, s, 1.21 * K, 2.78 * K),
          e.lineTo(t + c, r + c),
          e.lineTo(t, r + c),
          e.arc(t + s - 2, r + c / 2, s + 0.4, 2.76 * K, 1.24 * K, !0),
          e.lineTo(t, r),
          (e.lineWidth = 2),
          (e.fillStyle = 'rgba(255, 255, 255, 0.7)'),
          (e.strokeStyle = 'rgba(255, 255, 255, 0.7)'),
          e.stroke(),
          (e.globalCompositeOperation = 'destination-over'),
          'fill' === n ? e.fill() : e.clip();
      },
      ee = function () {
        return (
          m ||
          'https://picsum.photos/id/'
            .concat(d(0, 1084), '/')
            .concat(o, '/')
            .concat(i)
        );
      },
      te = function () {
        var e = (function (e) {
          var t = new Image();
          return (
            (t.crossOrigin = 'Anonymous'),
            (t.onload = e),
            (t.onerror = function () {
              t.setSrc(ee());
            }),
            (t.setSrc = function (e) {
              if (window.navigator.userAgent.indexOf('Trident') > -1) {
                var r = new XMLHttpRequest();
                (r.onloadend = function (e) {
                  var r = new FileReader();
                  r.readAsDataURL(e.target.response),
                    (r.onloadend = function (e) {
                      var r;
                      t.src =
                        null == e || null === (r = e.target) || void 0 === r
                          ? void 0
                          : r.result;
                    });
                }),
                  r.open('GET', e),
                  (r.responseType = 'blob'),
                  r.send();
              } else t.src = e;
            }),
            t.setSrc(ee()),
            t
          );
        })(function () {
          I(!1),
            (function (e) {
              var t = F.current.getContext('2d'),
                r = L.current.getContext('2d');
              (B.current = d(Q + 10, o - (Q + 10))),
                (J.current = d(10 + 2 * s, i - (Q + 10))),
                Z(t, B.current, J.current, 'fill'),
                Z(r, B.current, J.current, 'clip'),
                t.drawImage(e, 0, 0, o, i),
                r.drawImage(e, 0, 0, o, i);
              var n = J.current - 2 * s - 1,
                u = r.getImageData(B.current - 3, n, Q, Q);
              (L.current.width = Q), r.putImageData(u, 0, n);
            })(e);
        });
        W.current = e;
      },
      re = function () {
        var e = F.current.getContext('2d'),
          t = L.current.getContext('2d');
        D(0),
          q('sliderContainer'),
          (L.current.width = o),
          (L.current.style.left = '0px'),
          e.clearRect(0, 0, o, i),
          t.clearRect(0, 0, o, i),
          I(!0),
          W.current.setSrc(ee());
      },
      ne = function () {
        var e = H.current,
          t = e.reduce(p) / e.length,
          r = e.map(function (e) {
            return e - t;
          }),
          n = Math.sqrt(r.map(h).reduce(p) / e.length),
          o = parseInt(L.current.style.left);
        return {
          spliced: 10 > Math.abs(o - B.current),
          verified: 0 !== n,
          left: o,
          destX: B.current,
        };
      },
      oe = function (e) {
        ($.current = e.clientX || e.touches[0].clientX),
          (z.current = e.clientY || e.touches[0].clientY),
          (G.current = !0);
      },
      ue = function (e) {
        if (!G.current) return !1;
        e.preventDefault();
        var t = (e.clientX || e.touches[0].clientX) - $.current,
          r = (e.clientY || e.touches[0].clientY) - z.current;
        if (0 > t || t + 38 >= o) return !1;
        D(t);
        var n = ((o - 40 - 20) / (o - 40)) * t;
        (L.current.style.left = n + 'px'),
          q('sliderContainer sliderContainer_active'),
          H.current.push(r),
          w && w(n);
      },
      ie = function (e) {
        if (!G.current) return !1;
        if (
          ((G.current = !1),
          (e.clientX || e.changedTouches[0].clientX) === $.current)
        )
          return !1;
        q('sliderContainer');
        var t = M ? M(ne()) : ne();
        t.spliced
          ? t.verified
            ? (q('sliderContainer sliderContainer_success'),
              'function' == typeof C && C())
            : (q('sliderContainer sliderContainer_fail'), V('请再试一次'), re())
          : (q('sliderContainer sliderContainer_fail'),
            'function' == typeof _ && _(),
            setTimeout(re.bind(undefined), 1e3));
      };
    return (
      t.useEffect(
        function () {
          b && (W.current ? re() : te());
        },
        [b],
      ),
      n.default.createElement(
        'div',
        {
          className: 'vertifyWrap',
          style: {
            width: o + 'px',
            margin: '0 auto',
            display: b ? '' : 'none',
          },
          onMouseMove: ue,
          onMouseUp: ie,
          onTouchMove: ue,
          onTouchEnd: ie,
        },
        n.default.createElement(
          'div',
          { className: 'canvasArea' },
          n.default.createElement('canvas', { ref: F, width: o, height: i }),
          n.default.createElement('canvas', {
            ref: L,
            className: 'block',
            width: o,
            height: i,
            onMouseDown: oe,
            onTouchStart: oe,
          }),
        ),
        n.default.createElement(
          'div',
          {
            className: k,
            style: { pointerEvents: R ? 'none' : 'auto', width: o + 'px' },
          },
          n.default.createElement(
            'div',
            { className: 'sliderMask', style: { width: j + 'px' } },
            n.default.createElement(
              'div',
              {
                className: 'slider',
                style: { left: j + 'px' },
                onMouseDown: oe,
                onTouchStart: oe,
              },
              n.default.createElement('div', { className: 'sliderIcon' }, '→'),
            ),
          ),
          n.default.createElement('div', { className: 'sliderText' }, Y),
        ),
        n.default.createElement('div', {
          className: 'refreshIcon',
          onClick: function () {
            re(), 'function' == typeof E && E();
          },
          style: { backgroundImage: 'url('.concat(x, ')') },
        }),
        n.default.createElement(
          'div',
          {
            className: 'loadingContainer',
            style: {
              width: o + 'px',
              height: i + 'px',
              display: R ? '' : 'none',
            },
          },
          n.default.createElement('div', { className: 'loadingIcon' }),
          n.default.createElement('span', null, '加载中...'),
        ),
      )
    );
  })),
    Object.defineProperty(e, '__esModule', { value: !0 });
});
